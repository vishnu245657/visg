name: Global Job Monitor

on:
  schedule:
    - cron: '*/30 * * * *' # Runs every 30 minutes
  workflow_dispatch: # Allows you to run it manually

permissions:
  contents: write # REQUIRED: Allows the bot to save state files

jobs:
  run_bots:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install Libraries
        run: pip install requests beautifulsoup4

      # --- 1. RUN AMAZON BOT ---
      - name: Run Amazon Bot
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: python amazon_bot.py || true

      # --- 2. RUN SALESFORCE BOT ---
      - name: Run Salesforce Bot
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: python salesforce_bot.py || true

      # --- 3. RUN UPDATED GOOGLE BOT ---
      - name: Run Google Bot
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: python google_bot.py || true

      # --- 4. RUN META BOT ---
      - name: Run Meta Bot
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: python meta.py || true

      # --- 5. SAVE ALL STATES ---
      - name: Save Bot Memories
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "Update all job states"
          # This pattern grabs all state files generated by your bots
          file_pattern: "state_*.txt"
